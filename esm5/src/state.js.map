{"version":3,"file":"state.js","sourceRoot":"ng://@ngrx/store/","sources":["src/state.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,MAAM,EAAE,UAAU,EAAuB,MAAM,eAAe,CAAC;AACxE,OAAO,EACL,eAAe,EACf,UAAU,EACV,cAAc,GAEf,MAAM,MAAM,CAAC;AACd,OAAO,EAAE,SAAS,EAAE,IAAI,EAAE,cAAc,EAAE,MAAM,gBAAgB,CAAC;AAEjE,OAAO,EAAkB,IAAI,EAAE,MAAM,mBAAmB,CAAC;AAIzD,OAAO,EAAE,aAAa,EAAE,MAAM,UAAU,CAAC;;;;AAEzC;;;;IAA8C,mCAAe;IAA7D;;IAA+D,CAAC;IAAD,sBAAC;AAAD,CAAC,AAAhE,CAA8C,UAAU,GAAQ;;;;;;;;AAEhE;IAC8B,yBAAoB;IAKhD,eACE,QAAwB,EACxB,QAA2B,EAC3B,cAAqC,EACd,YAAiB;QAJ1C,YAME,kBAAM,YAAY,CAAC,SAwBpB;;YAtBO,eAAe,GAAuB,QAAQ,CAAC,IAAI,CACvD,SAAS,CAAC,cAAc,CAAC,CAC1B;;YACK,kBAAkB,GAEpB,eAAe,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;;YAE5C,IAAI,GAAuB,EAAE,KAAK,EAAE,YAAY,EAAE;;YAClD,eAAe,GAGhB,kBAAkB,CAAC,IAAI,CAC1B,IAAI,CACF,WAAW,EACX,IAAI,CACL,CACF;QAED,KAAI,CAAC,iBAAiB,GAAG,eAAe,CAAC,SAAS;;;;QAAC,UAAC,EAAiB;gBAAf,gBAAK,EAAE,kBAAM;YACjE,KAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACjB,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC9B,CAAC,EAAC,CAAC;;IACL,CAAC;;;;IAED,2BAAW;;;IAAX;QACE,IAAI,CAAC,iBAAiB,CAAC,WAAW,EAAE,CAAC;QACrC,IAAI,CAAC,QAAQ,EAAE,CAAC;IAClB,CAAC;IAvCe,UAAI,GAAG,IAAI,CAAC;;gBAF7B,UAAU;;;;gBARF,cAAc;gBAEd,iBAAiB;gBACjB,qBAAqB;gDAezB,MAAM,SAAC,aAAa;;IAgCzB,YAAC;CAAA,AA1CD,CAC8B,eAAe,GAyC5C;SAzCY,KAAK;;;IAChB,WAA4B;;;;;IAE5B,kCAAwC;;;;;;;;AA4C1C,MAAM,UAAU,WAAW,CACzB,eAA6D,EAC7D,EAA2C;IAD3C,gCAAA,EAAA,oBAA2C,KAAK,EAAE,SAAS,EAAE;QAC7D,kBAA2C,EAA1C,cAAM,EAAE,eAAO;IAER,IAAA,6BAAK;IACb,OAAO,EAAE,KAAK,EAAE,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,EAAE,MAAM,QAAA,EAAE,CAAC;AACnD,CAAC;;AAED,MAAM,KAAO,eAAe,GAAe;IACzC,KAAK;IACL,EAAE,OAAO,EAAE,eAAe,EAAE,WAAW,EAAE,KAAK,EAAE;CACjD","sourcesContent":["import { Inject, Injectable, OnDestroy, Provider } from '@angular/core';\nimport {\n  BehaviorSubject,\n  Observable,\n  queueScheduler,\n  Subscription,\n} from 'rxjs';\nimport { observeOn, scan, withLatestFrom } from 'rxjs/operators';\n\nimport { ActionsSubject, INIT } from './actions_subject';\nimport { Action, ActionReducer } from './models';\nimport { ReducerObservable } from './reducer_manager';\nimport { ScannedActionsSubject } from './scanned_actions_subject';\nimport { INITIAL_STATE } from './tokens';\n\nexport abstract class StateObservable extends Observable<any> {}\n\n@Injectable()\nexport class State<T> extends BehaviorSubject<any> implements OnDestroy {\n  static readonly INIT = INIT;\n\n  private stateSubscription: Subscription;\n\n  constructor(\n    actions$: ActionsSubject,\n    reducer$: ReducerObservable,\n    scannedActions: ScannedActionsSubject,\n    @Inject(INITIAL_STATE) initialState: any\n  ) {\n    super(initialState);\n\n    const actionsOnQueue$: Observable<Action> = actions$.pipe(\n      observeOn(queueScheduler)\n    );\n    const withLatestReducer$: Observable<\n      [Action, ActionReducer<any, Action>]\n    > = actionsOnQueue$.pipe(withLatestFrom(reducer$));\n\n    const seed: StateActionPair<T> = { state: initialState };\n    const stateAndAction$: Observable<{\n      state: any;\n      action?: Action;\n    }> = withLatestReducer$.pipe(\n      scan<[Action, ActionReducer<T, Action>], StateActionPair<T>>(\n        reduceState,\n        seed\n      )\n    );\n\n    this.stateSubscription = stateAndAction$.subscribe(({ state, action }) => {\n      this.next(state);\n      scannedActions.next(action);\n    });\n  }\n\n  ngOnDestroy() {\n    this.stateSubscription.unsubscribe();\n    this.complete();\n  }\n}\n\nexport type StateActionPair<T, V extends Action = Action> = {\n  state: T | undefined;\n  action?: V;\n};\nexport function reduceState<T, V extends Action = Action>(\n  stateActionPair: StateActionPair<T, V> = { state: undefined },\n  [action, reducer]: [V, ActionReducer<T, V>]\n): StateActionPair<T, V> {\n  const { state } = stateActionPair;\n  return { state: reducer(state, action), action };\n}\n\nexport const STATE_PROVIDERS: Provider[] = [\n  State,\n  { provide: StateObservable, useExisting: State },\n];\n"]}